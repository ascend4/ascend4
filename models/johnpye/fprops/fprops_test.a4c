(* test of the fluid properties routines currently implemented in asc_mbwr.c *)

REQUIRE "atoms.a4l";
REQUIRE "johnpye/thermo_types.a4c";
IMPORT "johnpye/fprops/helmholtz";

MODEL mbwrconf;
	component IS_A symbol_constant;
	component :== 'ammonia';
END mbwrconf;

MODEL fprops_test;

	p IS_A pressure;
	T IS_A temperature;
	rho IS_A mass_density;
	h IS_A specific_enthalpy;

	propsdata IS_A mbwrconf;

	props1: helmholtz_p(
		T, rho : INPUT;
		p : OUTPUT;
		propsdata : DATA
	);

	props2: helmholtz_h(
		T, rho : INPUT;
		h : OUTPUT;
		propsdata : DATA
	);

METHODS
METHOD on_load;
	RUN ClearAll;
	FIX rho, T;
	rho := 39.278 {kg/m^3};
	T := 300 {K} + 273.15 {K};
END on_load;
METHOD self_test;
	ASSERT abs(p - 10 {MPa}) < 0.001 {MPa};
	ASSERT abs(h - 2238.2 {kJ/kg}) < 0.1 {kJ/kg};
END self_test;

METHOD values_2;
	RUN on_load;
	rho := 74.732 {kg/m^3};
	T := 150 {K} + 273.15 {K};
END values_2;
METHOD self_test_2;
	ASSERT abs(p - 10 {MPa}) < 0.001 {MPa};
	ASSERT abs(h - 1688.5 {kJ/kg}) < 0.1 {kJ/kg};
END self_test_2;
END fprops_test;

