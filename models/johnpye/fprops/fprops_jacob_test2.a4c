(* My test of ASCEND fluid-properties (FPROPS) routines *)

REQUIRE "atoms.a4l";
REQUIRE "johnpye/thermo_types.a4c";
(*IMPORT "johnpye/fprops/helmholtz";*)
IMPORT "johnpye/fprops/fprops";

MODEL fprops_conf;
	component IS_A symbol_constant;
	component :== 'acetone';
END fprops_conf;

MODEL fprops_test;
	p IS_A pressure;
	T IS_A temperature;
	rho IS_A mass_density;
	h IS_A specific_enthalpy;
	u IS_A specific_energy;
	a IS_A specific_energy;
	s IS_A specific_entropy;

	conf IS_A fprops_conf;

	(* Property expressions:
	   	pressure p;
		internal energy u;
		entropy s;
		enthalpy h;
		helmholtz energy a
     *)
	prop_p : fprops_p(
		T, rho : INPUT;
		p : OUTPUT;
		conf : DATA
	);

	prop_u : fprops_u(
		T, rho : INPUT;
		u : OUTPUT;
		conf : DATA
	);

	prop_s : fprops_s(
		T, rho : INPUT;
		s : OUTPUT;
		conf : DATA
	);

	rho * (h - u) = p;
	a = u + T*s;

METHODS
METHOD on_load;
	RUN ClearAll;
	FIX T, p;
	T := 300 {K} + 273.15 {K};
	p := 9 {bar};
	(* u := 1300500 {J/kg}; *)
	(* rho := 200.5 {kg/m^3}; *)

	SOLVER QRSlv;
	OPTION convopt 'RELNOM_SCALE';
END on_load;

METHOD self_test;
	(*ASSERT abs(p - 10 {MPa}) < 0.001 {MPa};*)
	(*ASSERT abs(h - 2238.2 {kJ/kg}) < 0.1 {kJ/kg}*)
END self_test;

END fprops_test;

