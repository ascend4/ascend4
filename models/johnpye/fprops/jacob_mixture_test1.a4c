(* Outline of ASCEND multi-component ideal-solution routine *)

REQUIRE "atoms.a4l";
REQUIRE "johnpye/thermo_types.a4c";
IMPORT "johnpye/fprops/mixture";
REQUIRE "johnpye/fprops/mixtures.a4l";

(* The mixture_test model *)
MODEL mixture_test; (* ///1 *)
	T IS_A temperature;
	p IS_A pressure;
	rho IS_A mass_density;

	mixt IS_A mixture_spec;
	mixt.npure :== 3;
	mixt.components[1] :== 'ammonia';
	mixt.components[2] :== 'carbondioxide';
	mixt.components[3] :== 'cyclohexane';
	mixt.eos :== 'pengrob';
	mixt.xs[1] :== 0.4;
	mixt.xs[2] :== 0.35;
	mixt.xs[3] :== 0.25;

	(*
	phase_xs[1..3][1..mixt.npure] IS_A mass_fraction;
	phase_frac[1..3] IS_A mass_fraction;
	phase_rho[1..3][1..mixt.npure] IS_A mass_density;
	*)

	mix_density : mixture_rho(
		T, p : INPUT;
		rho : OUTPUT;
		mixt : DATA
	);

METHODS
METHOD specify; (* ///2 *)
	(*RUN mixt.specify;*)
	FIX T;
	FIX p;
END specify;
METHOD values; (* ///2 *)
	T := 300 {K} + 273.15 {K};
	p := 2 {bar};
END values;
METHOD options; (* ///2 *)
	SOLVER QRSlv;
	OPTION convopt 'RELNOM_SCALE';
END options;
METHOD setup; (* ///2 *)
	RUN specify;
	RUN values;
	RUN options;
END setup;
END mixture_test; (* //\1 *)
